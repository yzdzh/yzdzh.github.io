<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=""><link rel="stylesheet" type="text/css" href="//fonts.loli.net/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/css/style.css?v=2.0.5"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=2.0.5"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><link rel="stylesheet" type="text/css" href="https://unpkg.com/gitalk/dist/gitalk.css?v=2.0.5"><title>go依赖管理--Go modules | 星光的博客</title><script data-ad-client="ca-pub-5977992732306814" async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><meta name="generator" content="Hexo 4.2.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">go依赖管理--Go modules</h1><a id="logo" href="/.">星光的博客</a><p class="description"></p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="搜索"></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">go依赖管理--Go modules</h1><div class="post-meta"><a href="/post/2526408434.html#comments" class="comment-count"></a><p><span class="date">2020-05-12</span><span><a href="/categories/golang/" class="category">golang</a></span></p></div><div class="post-content"><h2 id="一、什么是Go-Modules"><a href="#一、什么是Go-Modules" class="headerlink" title="一、什么是Go Modules?"></a>一、什么是Go Modules?</h2><p>Go modules 是 Go 语言的依赖解决方案，发布于 Go1.11，成长于 Go1.12，丰富于 Go1.13，正式于 Go1.14 推荐在生产上使用。  </p>
<p>Go moudles 目前集成在 Go 的工具链中，只要安装了 Go，自然而然也就可以使用 Go moudles 了，而 Go modules 的出现也解决了在 Go1.11 前的几个常见争议问题：  </p>
<ol>
<li>Go 语言长久以来的依赖管理问题。  </li>
<li>“淘汰”现有的 GOPATH 的使用模式。  </li>
<li>统一社区中的其它的依赖管理工具（提供迁移功能）。  </li>
</ol>
<h2 id="二、GOPATH的工作模式"><a href="#二、GOPATH的工作模式" class="headerlink" title="二、GOPATH的工作模式"></a>二、GOPATH的工作模式</h2><p>Go Modoules的目的之一就是淘汰GOPATH, 那么GOPATH是个什么?  </p>
<p>为什么在 Go1.11 前就使用 GOPATH，而 Go1.11 后就开始逐步建议使用 Go modules，不再推荐 GOPATH 的模式了呢？  </p>
<h3 id="1-Wait-is-GOPATH"><a href="#1-Wait-is-GOPATH" class="headerlink" title="(1) Wait is GOPATH?"></a><strong>(1) Wait is GOPATH?</strong></h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">go</span> env</span><br><span class="line"></span><br><span class="line">GOPATH=<span class="string">"/home/itheima/go"</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>我们输入go env命令行后可以查看到 GOPATH 变量的结果，我们进入到该目录下进行查看，如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">go</span><br><span class="line">├── bin</span><br><span class="line">├── pkg</span><br><span class="line">└── src</span><br><span class="line">    ├── github.com</span><br><span class="line">    ├── golang.org</span><br><span class="line">    ├── google.golang.org</span><br><span class="line">    ├── gopkg.in</span><br><span class="line">    ....</span><br></pre></td></tr></table></figure>

<p>GOPATH目录下一共包含了三个子目录，分别是：</p>
<ul>
<li>bin：存储所编译生成的二进制文件。</li>
<li>pkg：存储预编译的目标文件，以加快程序的后续编译速度。</li>
<li>src：存储所有.go文件或源代码。在编写 Go 应用程序，程序包和库时，一般会以$GOPATH/src/github.com/foo/bar的路径进行存放。</li>
</ul>
<blockquote>
<p>因此在使用 GOPATH 模式下，我们需要将应用代码存放在固定的$GOPATH/src目录下，并且如果执行go get来拉取外部依赖会自动下载并安装到$GOPATH目录下。</p>
</blockquote>
<h3 id="2-GOPATH模式的弊端"><a href="#2-GOPATH模式的弊端" class="headerlink" title="(2) GOPATH模式的弊端"></a><strong>(2) GOPATH模式的弊端</strong></h3><p>在 GOPATH 的 $GOPATH/src 下进行 .go 文件或源代码的存储，我们可以称其为 GOPATH 的模式，这个模式拥有一些弊端.</p>
<p>A. 无版本控制概念. 在执行go get的时候，你无法传达任何的版本信息的期望，也就是说你也无法知道自己当前更新的是哪一个版本，也无法通过指定来拉取自己所期望的具体版本。<br>B.无法同步一致第三方版本号. 在运行 Go 应用程序的时候，你无法保证其它人与你所期望依赖的第三方库是相同的版本，也就是说在项目依赖库的管理上，你无法保证所有人的依赖版本都一致。<br>C.无法指定当前项目引用的第三方版本号. 你没办法处理 v1、v2、v3 等等不同版本的引用问题，因为 GOPATH 模式下的导入路径都是一样的，都是github.com/foo/bar。  </p>
<h2 id="三、Go-Modules模式"><a href="#三、Go-Modules模式" class="headerlink" title="三、Go Modules模式"></a>三、Go Modules模式</h2><p>我们接下来用Go Modules的方式创建一个项目, 建议为了与GOPATH分开,不要将项目创建在GOPATH/src下.</p>
<h3 id="1-go-mod命令"><a href="#1-go-mod命令" class="headerlink" title="(1) go mod命令"></a>(1) go mod命令</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">go</span> mod init：生成 <span class="keyword">go</span>.mod 文件</span><br><span class="line"><span class="keyword">go</span> mod download : 下载 <span class="keyword">go</span>.mod 文件中指明的所有依赖</span><br><span class="line"><span class="keyword">go</span> mod tidy: 整理现有的依赖</span><br><span class="line"><span class="keyword">go</span> mod graph: 查看现有的依赖结构</span><br><span class="line"><span class="keyword">go</span> mod edit : 编辑 <span class="keyword">go</span>.mod 文件</span><br><span class="line"><span class="keyword">go</span> mod vendor : 导出项目所有的依赖到vendor目录</span><br><span class="line"><span class="keyword">go</span> mod verify: 校验一个模块是否被篡改过</span><br><span class="line"><span class="keyword">go</span> mod why: 查看为什么需要依赖某模块</span><br></pre></td></tr></table></figure>

<h3 id="2-go-mod环境变量"><a href="#2-go-mod环境变量" class="headerlink" title="(2) go mod环境变量"></a>(2) go mod环境变量</h3><p>可以通过 go env 命令来进行查看</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">go</span> env</span><br><span class="line">GO111MODULE=<span class="string">"auto"</span></span><br><span class="line">GOPROXY=<span class="string">"https://proxy.golang.org,direct"</span></span><br><span class="line">GONOPROXY=<span class="string">""</span></span><br><span class="line">GOSUMDB=<span class="string">"sum.golang.org"</span></span><br><span class="line">GONOSUMDB=<span class="string">""</span></span><br><span class="line">GOPRIVATE=<span class="string">""</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h4 id="GO111MODULE"><a href="#GO111MODULE" class="headerlink" title="GO111MODULE"></a><strong>GO111MODULE</strong></h4><p>Go语言提供了 GO111MODULE这个环境变量来作为 Go modules 的开关，其允许设置以下参数：</p>
<p><strong>auto：</strong>只要项目包含了 go.mod 文件的话启用 Go modules，目前在 Go1.11 至 Go1.14 中仍然是默认值。<br><strong>on：</strong>启用 Go modules，推荐设置，将会是未来版本中的默认值。<br><strong>off：</strong>禁用 Go modules，不推荐设置。<br>可以通过来设置  </p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">go</span> env -w GO111MODULE=on</span><br></pre></td></tr></table></figure>

<h4 id="GOPROXY"><a href="#GOPROXY" class="headerlink" title="GOPROXY"></a><strong>GOPROXY</strong></h4><p>这个环境变量主要是用于设置 Go 模块代理（Go module proxy）,其作用是用于使 Go 在后续拉取模块版本时直接通过镜像站点来快速拉取。</p>
<p>GOPROXY 的默认值是：<a href="https://proxy.golang.org,direct" target="_blank" rel="noopener">https://proxy.golang.org,direct</a></p>
<p>proxy.golang.org国内访问不了,需要设置国内的代理.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">阿里云</span><br><span class="line">https:<span class="comment">//mirrors.aliyun.com/goproxy/</span></span><br><span class="line"></span><br><span class="line">七牛云</span><br><span class="line">https:<span class="comment">//goproxy.cn,direct</span></span><br></pre></td></tr></table></figure>

<p>如:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash $ <span class="keyword">go</span> env -w GOPROXY=https:<span class="comment">//goproxy.cn,direct</span></span><br></pre></td></tr></table></figure>

<p>GOPROXY 的值是一个以英文逗号 “,” 分割的 Go 模块代理列表，允许设置多个模块代理，假设你不想使用，也可以将其设置为 “off” ，这将会禁止 Go 在后续操作中使用任何 Go 模块代理。</p>
<p>如:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">go</span> env -w GOPROXY=https:<span class="comment">//goproxy.cn,https://mirrors.aliyun.com/goproxy/,direct</span></span><br><span class="line">direct</span><br></pre></td></tr></table></figure>

<p>而在刚刚设置的值中，我们可以发现值列表中有 “direct” 标识，它又有什么作用呢？</p>
<p>实际上 “direct” 是一个特殊指示符，用于指示 Go 回源到模块版本的源地址去抓取（比如 GitHub 等），场景如下：当值列表中上一个 Go 模块代理返回 404 或 410 错误时，Go 自动尝试列表中的下一个，遇见 “direct” 时回源，也就是回到源地址去抓取，而遇见 EOF 时终止并抛出类似 “invalid version: unknown revision…” 的错误。</p>
<h4 id="GOSUMDB"><a href="#GOSUMDB" class="headerlink" title="GOSUMDB"></a><strong>GOSUMDB</strong></h4><p>它的值是一个 Go checksum database，用于在拉取模块版本时（无论是从源站拉取还是通过 Go module proxy 拉取）保证拉取到的模块版本数据未经过篡改，若发现不一致，也就是可能存在篡改，将会立即中止。  </p>
<p>GOSUMDB 的默认值为：sum.golang.org，在国内也是无法访问的，但是 GOSUMDB 可以被 Go 模块代理所代理（详见：Proxying a Checksum Database）。</p>
<p>因此我们可以通过设置 GOPROXY 来解决，而先前我们所设置的模块代理 goproxy.cn 就能支持代理 sum.golang.org，所以这一个问题在设置 GOPROXY 后，你可以不需要过度关心。</p>
<p>另外若对 GOSUMDB 的值有自定义需求，其支持如下格式：</p>
<p>格式 1：<SUMDB_NAME>+<PUBLIC_KEY>。<br>格式 2：<SUMDB_NAME>+<PUBLIC_KEY> <SUMDB_URL>。<br>也可以将其设置为“off”，也就是禁止 Go 在后续操作中校验模块版本。</p>
<p>GONOPROXY/GONOSUMDB/GOPRIVATE<br>这三个环境变量都是用在当前项目依赖了私有模块，例如像是你公司的私有 git 仓库，又或是 github 中的私有库，都是属于私有模块，都是要进行设置的，否则会拉取失败。</p>
<p>更细致来讲，就是依赖了由 GOPROXY 指定的 Go 模块代理或由 GOSUMDB 指定 Go checksum database 都无法访问到的模块时的场景。</p>
<p>而一般建议直接设置 GOPRIVATE，它的值将作为 GONOPROXY 和 GONOSUMDB 的默认值，所以建议的最佳姿势是直接使用 GOPRIVATE。</p>
<p>并且它们的值都是一个以英文逗号 “,” 分割的模块路径前缀，也就是可以设置多个，例如：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">go</span> env -w GOPRIVATE=<span class="string">"git.example.com,github.com/eddycjy/mquote"</span></span><br></pre></td></tr></table></figure>

<p>设置后，前缀为 <a href="http://git.xxx.com" target="_blank" rel="noopener">http://git.xxx.com</a> 和 <a href="http://github.com/eddycjy/mquote" target="_blank" rel="noopener">http://github.com/eddycjy/mquote</a> 的模块都会被认为是私有模块。</p>
<p>如果不想每次都重新设置，我们也可以利用通配符，例如：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">go</span> env -w GOPRIVATE=<span class="string">"*.example.com"</span></span><br></pre></td></tr></table></figure>

<p>这样子设置的话，所有模块路径为 <a href="http://example.com" target="_blank" rel="noopener">http://example.com</a> 的子域名（例如：<a href="http://git.example.com）都将不经过" target="_blank" rel="noopener">http://git.example.com）都将不经过</a> Go module proxy 和 Go checksum database，需要注意的是不包括 <a href="http://example.com" target="_blank" rel="noopener">http://example.com</a> 本身。</p>
<h2 id="四、使用Go-Modules初始化项目"><a href="#四、使用Go-Modules初始化项目" class="headerlink" title="四、使用Go Modules初始化项目"></a>四、使用Go Modules初始化项目</h2><h3 id="1-开启Go-Modules"><a href="#1-开启Go-Modules" class="headerlink" title="(1) 开启Go Modules"></a>(1) 开启Go Modules</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">go</span> env -w GO111MODULE=on</span><br></pre></td></tr></table></figure>

<p>又或是可以通过直接设置系统环境变量（写入对应的~/.bash_profile 文件亦可）来实现这个目的：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ export GO111MODULE=on</span><br></pre></td></tr></table></figure>

<h3 id="2-初始化项目"><a href="#2-初始化项目" class="headerlink" title="(2) 初始化项目"></a>(2) 初始化项目</h3><p>创建项目目录</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir -p $HOME/aceld/modules_test</span><br><span class="line">$ cd $HOME/aceld/modules_test</span><br></pre></td></tr></table></figure>

<p>执行Go modules 初始化</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">go</span> mod init github.com/aceld/modules_test</span><br><span class="line"><span class="keyword">go</span>: creating <span class="built_in">new</span> <span class="keyword">go</span>.mod: module github.com/aceld/modules_test</span><br></pre></td></tr></table></figure>

<p>​ 在执行 go mod init 命令时，我们指定了模块导入路径为 github.com/aceld/modules_test。接下来我们在该项目根目录下创建 main.go 文件，如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"github.com/aceld/zinx/znet"</span></span><br><span class="line">    <span class="string">"github.com/aceld/zinx/ziface"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">//ping test 自定义路由</span></span><br><span class="line"><span class="keyword">type</span> PingRouter <span class="keyword">struct</span> &#123;</span><br><span class="line">    znet.BaseRouter</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Ping Handle</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *PingRouter)</span> <span class="title">Handle</span><span class="params">(request ziface.IRequest)</span></span> &#123;</span><br><span class="line">    <span class="comment">//先读取客户端的数据</span></span><br><span class="line">    fmt.Println(<span class="string">"recv from client : msgId="</span>, request.GetMsgID(), </span><br><span class="line">              <span class="string">", data="</span>, <span class="keyword">string</span>(request.GetData()))</span><br><span class="line"></span><br><span class="line">    <span class="comment">//再回写ping...ping...ping</span></span><br><span class="line">    err := request.GetConnection().SendBuffMsg(<span class="number">0</span>, []<span class="keyword">byte</span>(<span class="string">"ping...ping...ping"</span>))</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      fmt.Println(err)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">//1 创建一个server句柄</span></span><br><span class="line">    s := znet.NewServer()</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2 配置路由</span></span><br><span class="line">    s.AddRouter(<span class="number">0</span>, &amp;PingRouter&#123;&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3 开启服务</span></span><br><span class="line">    s.Serve()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>OK, 我们先不要关注代码本身,我们看当前的main.go也就是我们的aceld/modules_test项目,是依赖一个叫github.com/aceld/zinx库的. znet和ziface只是zinx的两个模块.</p>
<p>接下来我们在$HOME/aceld/modules_test,本项目的根目录执行</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">go</span> get github.com/aceld/zinx/znet</span><br><span class="line"></span><br><span class="line"><span class="keyword">go</span>: downloading github.com/aceld/zinx v0<span class="number">.0</span><span class="number">.0</span><span class="number">-20200221135252</span><span class="number">-8</span>a8954e75100</span><br><span class="line"><span class="keyword">go</span>: found github.com/aceld/zinx/znet in github.com/aceld/zinx v0<span class="number">.0</span><span class="number">.0</span><span class="number">-20200221135252</span><span class="number">-8</span>a8954e75100</span><br></pre></td></tr></table></figure>

<p>我们会看到 我们的go.mod被修改,同时多了一个go.sum文件.</p>
<h3 id="3-查看go-mod文件"><a href="#3-查看go-mod文件" class="headerlink" title="(3) 查看go.mod文件"></a>(3) 查看go.mod文件</h3><p>aceld/modules_test/go.mod</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">module github.com/aceld/modules_test</span><br><span class="line"></span><br><span class="line"><span class="keyword">go</span> <span class="number">1.14</span></span><br><span class="line"></span><br><span class="line">require github.com/aceld/zinx v0<span class="number">.0</span><span class="number">.0</span><span class="number">-20200221135252</span><span class="number">-8</span>a8954e75100 <span class="comment">// indirect</span></span><br></pre></td></tr></table></figure>

<p>我们来简单看一下这里面的关键字</p>
<p>module: 用于定义当前项目的模块路径</p>
<p>go:标识当前Go版本.即初始化版本</p>
<p>require: 当前项目依赖的一个特定的必须版本</p>
<p>// indirect: 示该模块为间接依赖，也就是在当前应用程序中的 import 语句中，并没有发现这个模块的明确引用，有可能是你先手动 go get 拉取下来的，也有可能是你所依赖的模块所依赖的.我们的代码很明显是依赖的”github.com/aceld/zinx/znet”和”github.com/aceld/zinx/ziface”,所以就间接的依赖了github.com/aceld/zinx</p>
<h3 id="4-查看go-sum文件"><a href="#4-查看go-sum文件" class="headerlink" title="(4) 查看go.sum文件"></a>(4) 查看go.sum文件</h3><p>在第一次拉取模块依赖后，会发现多出了一个 go.sum 文件，其详细罗列了当前项目直接或间接依赖的所有模块版本，并写明了那些模块版本的 SHA-256 哈希值以备 Go 在今后的操作中保证项目所依赖的那些模块版本不会被篡改。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">github.com/aceld/zinx v0<span class="number">.0</span><span class="number">.0</span><span class="number">-20200221135252</span><span class="number">-8</span>a8954e75100 h1:Ez5iM6cKGMtqvIJ8nvR9h74Ln8FvFDgfb7bJIbrKv54=</span><br><span class="line">github.com/aceld/zinx v0<span class="number">.0</span><span class="number">.0</span><span class="number">-20200221135252</span><span class="number">-8</span>a8954e75100/<span class="keyword">go</span>.mod h1:bMiERrPdR8FzpBOo86nhWWmeHJ1cCaqVvWKCGcDVJ5M=</span><br><span class="line">github.com/golang/protobuf v1<span class="number">.3</span><span class="number">.3</span>/<span class="keyword">go</span>.mod h1:vzj43D7+SQXF/<span class="number">4</span>pzW/hwtAqwc6iTitCiVSaWz5lYuqw=</span><br></pre></td></tr></table></figure>

<p>我们可以看到一个模块路径可能有如下两种：</p>
<p>h1:hash情况</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">github.com/aceld/zinx v0<span class="number">.0</span><span class="number">.0</span><span class="number">-20200221135252</span><span class="number">-8</span>a8954e75100 h1:Ez5iM6cKGMtqvIJ8nvR9h74Ln8FvFDgfb7bJIbrKv54=</span><br></pre></td></tr></table></figure>

<p>go.mod hash情况</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">github.com/aceld/zinx v0<span class="number">.0</span><span class="number">.0</span><span class="number">-20200221135252</span><span class="number">-8</span>a8954e75100/<span class="keyword">go</span>.mod h1:bMiERrPdR8FzpBOo86nhWWmeHJ1cCaqVvWKCGcDVJ5M=</span><br><span class="line">github.com/golang/protobuf v1<span class="number">.3</span><span class="number">.3</span>/<span class="keyword">go</span>.mod h1:vzj43D7+SQXF/<span class="number">4</span>pzW/hwtAqwc6iTitCiVSaWz5lYuqw=</span><br></pre></td></tr></table></figure>

<p>h1 hash 是 Go modules 将目标模块版本的 zip 文件开包后，针对所有包内文件依次进行 hash，然后再把它们的 hash 结果按照固定格式和算法组成总的 hash 值。</p>
<p>而 h1 hash 和 go.mod hash 两者，要不就是同时存在，要不就是只存在 go.mod hash。那什么情况下会不存在 h1 hash 呢，就是当 Go 认为肯定用不到某个模块版本的时候就会省略它的 h1 hash，就会出现不存在 h1 hash，只存在 go.mod hash 的情况。</p>
<h2 id="五、修改模块的版本依赖关系"><a href="#五、修改模块的版本依赖关系" class="headerlink" title="五、修改模块的版本依赖关系"></a>五、修改模块的版本依赖关系</h2><p>​ 为了作尝试,假定我们现在都zinx版本作了升级, 由zinx v0.0.0-20200221135252-8a8954e75100 升级到 zinx v0.0.0-20200306023939-bc416543ae24 (注意zinx是一个没有打版本tag打第三方库,如果有的版本号是有tag的,那么可以直接对应v后面的版本号即可)</p>
<p>​ 那么,我们是怎么知道zinx做了升级呢, 我们又是如何知道的最新的zinx版本号是多少呢?</p>
<p>​ 先回到$HOME/aceld/modules_test,本项目的根目录执行</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">go</span> get github.com/aceld/zinx/znet</span><br><span class="line"><span class="keyword">go</span>: downloading github.com/aceld/zinx v0<span class="number">.0</span><span class="number">.0</span><span class="number">-20200306023939</span>-bc416543ae24</span><br><span class="line"><span class="keyword">go</span>: found github.com/aceld/zinx/znet in github.com/aceld/zinx v0<span class="number">.0</span><span class="number">.0</span><span class="number">-20200306023939</span>-bc416543ae24</span><br><span class="line"><span class="keyword">go</span>: github.com/aceld/zinx upgrade =&gt; v0<span class="number">.0</span><span class="number">.0</span><span class="number">-20200306023939</span>-bc416543ae24</span><br></pre></td></tr></table></figure>

<p>这样我们,下载了最新的zinx, 版本是v0.0.0-20200306023939-bc416543ae24</p>
<p>​ 然后,我么看一下go.mod</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">module github.com/aceld/modules_test</span><br><span class="line"></span><br><span class="line"><span class="keyword">go</span> <span class="number">1.14</span></span><br><span class="line"></span><br><span class="line">require github.com/aceld/zinx v0<span class="number">.0</span><span class="number">.0</span><span class="number">-20200306023939</span>-bc416543ae24 <span class="comment">// indirect</span></span><br></pre></td></tr></table></figure>

<p>我们会看到,当我们执行go get 的时候, 会自动的将本地将当前项目的require更新了.变成了最新的依赖.</p>
<p>好了, 现在我们就要做另外一件事,就是,我们想用一个旧版本的zinx. 来修改当前zinx模块的依赖版本号.</p>
<p>目前我们在$GOPATH/pkg/mod/github.com/aceld下,已经有了两个版本的zinx库</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/<span class="keyword">go</span>/pkg/mod/github.com/aceld$ ls</span><br><span class="line">zinx@v0<span class="number">.0</span><span class="number">.0</span><span class="number">-20200221135252</span><span class="number">-8</span>a8954e75100</span><br><span class="line">zinx@v0<span class="number">.0</span><span class="number">.0</span><span class="number">-20200306023939</span>-bc416543ae24</span><br></pre></td></tr></table></figure>

<p>​ 目前,我们/aceld/modules_test依赖的是<a href="mailto:zinx@v0.0.0-20200306023939-bc416543ae24">zinx@v0.0.0-20200306023939-bc416543ae24</a> 这个是最新版, 我们要改成之前的版本<a href="mailto:zinx@v0.0.0-20200306023939-bc416543ae24">zinx@v0.0.0-20200306023939-bc416543ae24</a>.</p>
<p>​ 回到/aceld/modules_test项目目录下,执行</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">go</span> mod edit -replace=zinx@v0<span class="number">.0</span><span class="number">.0</span><span class="number">-20200306023939</span>-bc416543ae24=zinx@v0<span class="number">.0</span><span class="number">.0</span><span class="number">-20200221135252</span><span class="number">-8</span>a8954e75100</span><br></pre></td></tr></table></figure>

<p>​ 然后我们打开go.mod查看一下</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">module github.com/aceld/modules_test</span><br><span class="line"></span><br><span class="line"><span class="keyword">go</span> <span class="number">1.14</span></span><br><span class="line"></span><br><span class="line">require github.com/aceld/zinx v0<span class="number">.0</span><span class="number">.0</span><span class="number">-20200306023939</span>-bc416543ae24 <span class="comment">// indirect</span></span><br><span class="line"></span><br><span class="line">replace zinx v0<span class="number">.0</span><span class="number">.0</span><span class="number">-20200306023939</span>-bc416543ae24 =&gt; zinx v0<span class="number">.0</span><span class="number">.0</span><span class="number">-20200221135252</span><span class="number">-8</span>a8954e75100</span><br></pre></td></tr></table></figure>

<p>​ 这里出现了replace关键字.用于将一个模块版本替换为另外一个模块版本。</p>
<p>文章参考：<a href="https://zhuanlan.zhihu.com/p/113506780" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/113506780</a></p>
</div><div class="post-copyright"><blockquote><p>原文作者: xingguang</p><p>原文链接: <a href="https://yzdzh.github.io/post/2526408434.html">https://yzdzh.github.io/post/2526408434.html</a></p><p>版权声明: 转载请注明出处(必须保留作者署名及链接)</p></blockquote></div><div class="tags"></div><div class="post-share"><div class="social-share"><span>分享到:</span></div></div><div class="post-nav"><a href="/post/3838666233.html" class="pre">golang之json操作库</a><a href="/post/579789855.html" class="next">MongoDB中各种类型的索引</a></div><div id="comments"><div id="container"><script type="text/javascript" src="https://unpkg.com/gitalk/dist/gitalk.min.js?v=2.0.5"></script><script type="text/javascript" src="//cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.js?v=2.0.5"></script><script>var gitalk = new Gitalk({
  clientID: 'fe51b6fab2e6bc732537',
  clientSecret: '73b392debaae9e2cb42af08aeeb8f9de753b00b8',
  repo: 'blogtalk',
  owner: 'yizhidaozuihou',
  admin: ['yizhidaozuihou'],
  id: md5(window.location.pathname),
  distractionFreeMode: false,
  language: 'zh-CN',
  pagerDirection: 'last'
})
gitalk.render('container')</script></div></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="search-pla"></div><div id="toc" class="widget"><div class="widget-title"><i class="fa fa-fei">文章目录</i></div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#一、什么是Go-Modules"><span class="toc-text">一、什么是Go Modules?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#二、GOPATH的工作模式"><span class="toc-text">二、GOPATH的工作模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Wait-is-GOPATH"><span class="toc-text">(1) Wait is GOPATH?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-GOPATH模式的弊端"><span class="toc-text">(2) GOPATH模式的弊端</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#三、Go-Modules模式"><span class="toc-text">三、Go Modules模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-go-mod命令"><span class="toc-text">(1) go mod命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-go-mod环境变量"><span class="toc-text">(2) go mod环境变量</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#GO111MODULE"><span class="toc-text">GO111MODULE</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#GOPROXY"><span class="toc-text">GOPROXY</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#GOSUMDB"><span class="toc-text">GOSUMDB</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#四、使用Go-Modules初始化项目"><span class="toc-text">四、使用Go Modules初始化项目</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-开启Go-Modules"><span class="toc-text">(1) 开启Go Modules</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-初始化项目"><span class="toc-text">(2) 初始化项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-查看go-mod文件"><span class="toc-text">(3) 查看go.mod文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-查看go-sum文件"><span class="toc-text">(4) 查看go.sum文件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#五、修改模块的版本依赖关系"><span class="toc-text">五、修改模块的版本依赖关系</span></a></li></ol></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/post/3830161646.html">rabbitmq的四种交换机类型</a></li><li class="post-list-item"><a class="post-list-link" href="/post/3544074938.html">快捷搭建vpn</a></li><li class="post-list-item"><a class="post-list-link" href="/post/3450921099.html">wsl安装centos7方法</a></li><li class="post-list-item"><a class="post-list-link" href="/post/1539025967.html">WSL2 从C盘 导入到 D盘</a></li><li class="post-list-item"><a class="post-list-link" href="/post/1542514284.html">certbot自动签证机器人</a></li><li class="post-list-item"><a class="post-list-link" href="/post/2040882575.html">Windows11安装Android子系统及抓包方法</a></li><li class="post-list-item"><a class="post-list-link" href="/post/2119301209.html">java新启程-HelloWorld</a></li><li class="post-list-item"><a class="post-list-link" href="/post/984256984.html">ab压测工具</a></li><li class="post-list-item"><a class="post-list-link" href="/post/3478081417.html">linux网络带宽监控工具</a></li><li class="post-list-item"><a class="post-list-link" href="/post/710540892.html">k8s-集群搭建的三种方式和区别，kubeadm、minikube，二进制包</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-gui"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/"> </a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/wsl/">wsl</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Elasticsearch/">Elasticsearch</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Redis/">Redis</a><span class="category-list-count">3</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Redis/yii2/">yii2</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/docker/">docker</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/golang/">golang</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/hexo%E6%8A%98%E8%85%BE/">hexo折腾</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/">java</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/k8s/">k8s</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a><span class="category-list-count">16</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/mongodb/">mongodb</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/mysql/">mysql</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/php/">php</a><span class="category-list-count">21</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/phpStorm/">phpStorm</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/rabbitmq/">rabbitmq</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/swoole/">swoole</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/vagrant/">vagrant</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/wsl/">wsl</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%85%B6%E4%BB%96%E7%BC%96%E7%A8%8B/">其他编程</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BC%96%E7%A8%8B%E6%80%9D%E6%83%B3/">编程思想</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BC%96%E7%A8%8B%E7%90%90%E7%A2%8E/">编程琐碎</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/">网络协议</a><span class="category-list-count">2</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-archive"> 归档</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/">2022</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/">2021</a><span class="archive-list-count">15</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/">2020</a><span class="archive-list-count">31</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/">2019</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/">2018</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/">2017</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/">2016</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/">2015</a><span class="archive-list-count">3</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-you"> 友情链接</i></div><ul></ul><a href="http://doc.aiwaly.com/docs/golang/golang-1b9du6af0iu7b" title="go大神笔记" target="_blank">go大神笔记</a><ul></ul><a href="https://learnku.com/docs/gin-gonic/2019/go-gin-document/6149" title="gin框架中文文档" target="_blank">gin框架中文文档</a><ul></ul><a href="https://learnku.com/articles/41230" title="golang第三方包大全" target="_blank">golang第三方包大全</a></div></div></div></div><a id="totop" href="#top"></a><div id="footer"><div class="footer-info"><p><a href="/baidusitemap.xml">网站地图</a> |  <a href="/atom.xml">订阅本站</a> |  <a href="/about/">联系博主</a><p><a href="http://www.beian.miit.gov.cn/" style="color:#f72b07" target="_blank"> </a></p></p><p><span> Copyright &copy;<a href="/." rel="nofollow">xingguang.</a></span><span> Theme by<a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> BlueLake.</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span></p></div></div></div><script type="text/javascript" src="/js/search.json.js?v=2.0.5"></script><script>//百度统计
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?9d26cb37102d613f1bb272ba408ec7b0";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();
</script><script>//百度自动推送
(function(){
var bp = document.createElement('script');
var curProtocol = window.location.protocol.split(':')[0];
if (curProtocol === 'https') {
bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
}
else {
bp.src = 'http://push.zhanzhang.baidu.com/push.js';
}
var s = document.getElementsByTagName("script")[0];
s.parentNode.insertBefore(bp, s);
})();
</script><script>//360搜索自动推送
(function(){
var src = "https://jspassport.ssl.qhimg.com/11.0.1.js?d182b3f28525f2db83acfaaf6e696dba";
document.write('<script src="' + src + '" id="sozz"><\\/script>');
})();</script><div id="fullscreen-img" class="hide"><span class="close"></span></div><script type="text/javascript" src="/js/imgview.js?v=2.0.5" async></script><script type="text/javascript" src="/js/toctotop.js?v=2.0.5" async></script><link rel="stylesheet" type="text/css" href="/share/css/share.css"><script type="text/javascript" src="/share/js/social-share.js" charset="utf-8"></script><script type="text/javascript" src="/share/js/qrcode.js" charset="utf-8"></script></body></html>